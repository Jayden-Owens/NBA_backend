{"version":3,"names":["_express","_interopRequireWildcard","require","_chargebee","_interopRequireDefault","_stripe","_auth","_user","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","router","Router","stripe","Stripe","process","env","STRIPE_SECRET_KEY","apiVersion","post","isAuthenticatedUser","req","res","email","name","body","stripeCustomer","customers","list","data","length","create","chargebeeCustomerResponse","chargebee","customer","request","chargebeeCustomer","newChargebeeCustomer","first_name","status","json","success","stripe_id","chargebee_id","id","customer_info","error","console","message","plan_id","paymentMethodId","amount","paymentMethod","paymentMethods","attach","stripe_customer_id","update","invoice_settings","default_payment_method","paymentIntent","paymentIntents","currency","payment_method","off_session","confirm","receipt_email","result","subscription","create_with_items","subscription_items","item_price_id","unit_price","payment_intent","gateway_account_id","CHARGEBEE_STRIPE_GATEWAY_ID","gw_payment_intent_id","user","User","findById","trialStartDate","Date","trialExpired","save","subscriptionId","send","cancel","end_of_term","express","raw","type","rawBody","signature","headers","event","webhooks","verify","log","event_type","content","received","err","_default","exports"],"sources":["subscription.js"],"mappings":"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","ignoreList":[]}